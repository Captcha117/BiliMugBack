<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.oken1.modules.mug.dao.VideoDao">
    <select id="getVideosByGameId" resultType="map">
        SELECT
        v.aid,
        v.title,
        v.pub_time,
        v.copyright,
        v.uid,
        v.play,
        u.id,
        c.type
        FROM
        video v
        LEFT JOIN video_content c ON v.aid = c.aid
        LEFT JOIN uploader u ON v.uid = u.uid
        WHERE
        ( c.type = 'G' and c.content_id = #{gameId} )
        or ( c.type = 'S' and c.content_id in ( select s.song_id from song s where s.game_id = #{gameId} ) )
        or ( c.type = 'C' and c.content_id in ( select c.chart_id from chart c
        left join song s on s.song_id = c.song_id left join game g on s.game_id = g.game_id
        where g.game_id = #{gameId} ) )
        ORDER BY
        play DESC
    </select>
</mapper>